<!DOCTYPE html>
<html lang="ja">
<head>
  <link rel="icon" href="favicon.png" type="image/png">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <title>æ¶ç©ºå§”å“¡ä¼šå®—æ•™å®—æ•™ æ¶ç©ºå®—æ•™ã®ç³»è­œå›³</title>
  <link rel="stylesheet" href="keifustyle.css">

  <style>
    :root{
      --maxw: 1100px;
      --pad: 14px;
      --nav-h: 52px;
      --text: #111;
      --muted: #918f8f;
      --bg: #fff;
    }

    html, body{
      margin:0;
      padding:0;
      background: var(--bg);
      color: var(--text);
      font-family: system-ui, -apple-system, "Segoe UI", "Noto Sans JP", "Hiragino Kaku Gothic ProN", sans-serif;
    }

    /* âœ…ãƒŠãƒ“ï¼šä¸­å¤®å¯„ã›ã€æ ç·šãªã— */
    header{
      position: sticky;
      top: 0;
      z-index: 10;
      background: rgba(255,255,255,0.92);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
    }
    header nav{
      height: var(--nav-h);
      max-width: var(--maxw);
      margin: 0 auto;
      padding: 0 var(--pad);
      display: flex;
      justify-content: center;
      gap: 14px;
      align-items: center;
      overflow-x: auto;
      -webkit-overflow-scrolling: touch;
      white-space: nowrap;
    }
    header nav a{
      color: var(--text);
      text-decoration: none;
      font-size: 14px;
      padding: 8px 10px;
      border: none;
      border-radius: 999px;
      flex: 0 0 auto;
    }
  

    main{
      max-width: var(--maxw);
      margin: 0 auto;
      padding: 18px var(--pad) 10px;
      text-align: center;
    }

    h1{
      margin: 10px 0 14px;
      font-size: 18px;
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    /* âœ…ã“ã“ãŒæœ¬å‘½ï¼šæœ€åˆã¯â€œå…¨ä½“ãŒåã¾ã‚‹â€ */
    .map{
      width: 100%;
      height: min(72vh, 680px);
      margin: 0 auto;
      background: #fff;
      overflow: hidden; /* å›³ãŒã¯ã¿å‡ºã—ã¦ã‚‚éš ã™ */
      touch-action: none; /* ãƒ”ãƒ³ãƒ/ãƒ‰ãƒ©ãƒƒã‚°ã‚’JSã§æ‰±ã† */
      position: relative;
    }

    /* SVGã¯â€œæœ€åˆã¯ãƒ•ã‚£ãƒƒãƒˆâ€ã•ã›ã‚‹ãŸã‚ã€ã‚³ãƒ³ãƒ†ãƒŠã«100%ã§å…¥ã‚Œã‚‹ */
    svg{
      width: 100%;
      height: 100%;
      display: block;
    }

    /* SVGã®ä¸­èº«ã‚’transformã™ã‚‹ãŸã‚ã®ã‚°ãƒ«ãƒ¼ãƒ— */
    .viewport{
      transform-origin: 0 0;
    }

    footer{
      color: var(--muted);
      font-size: 12px;
      text-align: center;
      padding: 22px 0 calc(22px + env(safe-area-inset-bottom));
      opacity: 0.9;
      font-weight: normal;
    }
    footer .small{ margin: 6px 0; }
  </style>
</head>

<body>
  <header>
    <nav>
      <a href="index.html">Home</a>
      <a href="kiss.Activityrecord.html">Activity record</a>
      <a href="kissgenealogy.html">Genealogy</a>
    </nav>
  </header>

  <main>
    <h1>ç³»è­œ</h1>

    <!-- âœ…ã“ã“ã§â€œåœ°å›³â€åŒ– -->
    <div class="map" id="map">
      <svg id="svg" viewBox="0 0 1100 600" role="img" aria-label="æ¶ç©ºå®—æ•™ã®ç³»è­œå›³">
        <defs>
          <clipPath id="clipCircle50">
            <circle r="50" cx="0" cy="0"></circle>
          </clipPath>
          <style>
            .node { cursor: pointer; }
            .ring { fill:#D3D3D3; stroke:#000; stroke-width:2; }
            .line { stroke:#000; stroke-width:2; }
            .dash { stroke-dasharray: 5,5; }
          </style>
        </defs>

        <!-- ğŸ‘‡ä¸­èº«å…¨éƒ¨ã‚’ã“ã®gã«å…¥ã‚Œã‚‹ï¼ˆtransformå¯¾è±¡ï¼‰ -->
        <g class="viewport" id="viewport">

          <!-- æ·±å±¤ç ”ç©¶ä¼š -->
          <a href="shinsou.html">
            <g class="node" transform="translate(400 100)">
              <circle class="ring" r="50"></circle>
              <image href="shinsou.jpg" x="-50" y="-50" width="100" height="100" clip-path="url(#clipCircle50)"></image>
            </g>
          </a>

          <line class="line" x1="400" y1="150" x2="300" y2="250"></line>

          <!-- Life Expectancy -->
          <a href="life.html">
            <g class="node" transform="translate(300 250)">
              <circle class="ring" r="50"></circle>
              <image href="lifeexpectancy.jpg" x="-50" y="-50" width="100" height="100" clip-path="url(#clipCircle50)"></image>
            </g>
          </a>

          <line class="line" x1="400" y1="150" x2="500" y2="250"></line>

          <!-- Rebirth -->
          <a href="rebirth.html">
            <g class="node" transform="translate(500 250)">
              <circle class="ring" r="50"></circle>
              <image href="rebirth.jpg" x="-50" y="-50" width="100" height="100" clip-path="url(#clipCircle50)"></image>
            </g>
          </a>

          <!-- è„±æˆ‘é€£åˆï¼ˆç‹¬ç«‹ï¼‰ -->
          <a href="datsuga.html" target="_blank">
            <g class="node" transform="translate(650 100)">
              <circle class="ring" r="50"></circle>
              <image href="datsugalogo.jpg" x="-50" y="-50" width="100" height="100" clip-path="url(#clipCircle50)"></image>
            </g>
          </a>

          <!-- å—é–ƒï¼ˆç‹¬ç«‹ï¼‰ -->
          <a href="minami sen.html" target="_blank">
            <g class="node" transform="translate(800 100)">
              <circle class="ring" r="50"></circle>
              <image href="minamisen.png" x="-50" y="-50" width="100" height="100" clip-path="url(#clipCircle50)"></image>
            </g>
          </a>

          <!-- è¤‡ä¿ä¼šï¼ˆç‹¬ç«‹ï¼‰ -->
          <a href="fukuhokai.html" target="_blank">
            <g class="node" transform="translate(950 100)">
              <circle class="ring" r="50"></circle>
              <image href="è¤‡ä¿ä¼šï¼’.png" x="-50" y="-50" width="100" height="100" clip-path="url(#clipCircle50)"></image>
            </g>
          </a>

          <!-- ã°ãï¼ˆç‚¹ç·šï¼‰ -->
          <line class="line dash" x1="350" y1="100" x2="250" y2="100"></line>
          <a href="baku.html" target="_blank">
            <g class="node" transform="translate(250 100)">
              <circle class="ring" r="50"></circle>
              <image href="ã°ã.png" x="-50" y="-50" width="100" height="100" clip-path="url(#clipCircle50)"></image>
            </g>
          </a>

          <!-- åŒå‘½ä¼š -->
          <a href="soumeikai.html" target="_blank">
            <g class="node" transform="translate(725 240)">
              <circle class="ring" r="50"></circle>
              <image href="soumeikailogo.png" x="-50" y="-50" width="100" height="100" clip-path="url(#clipCircle50)"></image>
            </g>
          </a>
          <a href="lovebombingsociety.html" target="_blank" rel="noopener noreferrer">
            <g class="node" transform="translate(865 240)">
              <circle class="ring" r="50"></circle>
              <image href="naizaishingakukai.png"
                     x="-50" y="-50"
                     width="100" height="100"
                     clip-path="url(#clipCircle50)"></image>
            </g>
          </a>

          <!-- å†…åœ¨ç¥å­¦ä¼š â†’ LoveBombingSociety -->
          <line class="line" x1="865" y1="290" x2="865" y2="340"></line>

          <!-- LoveBombingSocietyï¼ˆå†…åœ¨ç¥å­¦ä¼šã®ä¸‹ï¼‰ -->
          <a href="https://www.lovebombingsociety.com" target="_blank" rel="noopener noreferrer">
            <g class="node" transform="translate(865 390)">
              <circle class="ring" r="50"></circle>
              <image href="lovebombingsociety.png"
                     x="-50" y="-50"
                     width="100" height="100"
                     clip-path="url(#clipCircle50)"></image>
            </g>
          </a>

          <!-- LoveBombingSociety â†’ è«–æ–‡ï¼ˆPDFï¼‰ -->
          <line class="line" x1="865" y1="440" x2="865" y2="490"></line>

          <!-- è«–æ–‡ãƒãƒ¼ãƒ‰ï¼ˆPDFï¼‰ -->
          <a href="Love Bombing Society.pdf" target="_blank">
            <g class="node" transform="translate(865 540)">
              <circle class="ring" r="50"></circle>
              <image href="ronbun.png"
                     x="-50" y="-50"
                     width="100" height="100"
                     clip-path="url(#clipCircle50)"></image>
            </g>
          </a>


        </g>
      </svg>
    </div>
  </main>

  <footer>
    <p class="small">&copy;2024 æ¶ç©º å§”å“¡ä¼š å®—æ•™ å®—æ•™</p>
    <p class="small">ãŠå•ã„åˆã‚ã›: kiss.info.japan@gmail.com</p>
  </footer>

  <script>
(() => {
  const map = document.getElementById('map');
  const viewport = document.getElementById('viewport');
  const svg = document.getElementById('svg');

  let scale = 1, tx = 0, ty = 0;
  const MIN_SCALE = 1;
  const MAX_SCALE = 6;

  function apply(){
    viewport.setAttribute('transform', `translate(${tx} ${ty}) scale(${scale})`);
  }

  function zoomAt(clientX, clientY, nextScale){
    const rect = map.getBoundingClientRect();
    const vb = svg.viewBox.baseVal;

    const x = (clientX - rect.left) * (vb.width / rect.width);
    const y = (clientY - rect.top)  * (vb.height / rect.height);

    const k = nextScale / scale;
    tx = x - k * (x - tx);
    ty = y - k * (y - ty);

    scale = nextScale;
    apply();
  }

  // ---- ãƒ‘ãƒ³ï¼ˆãƒ‰ãƒ©ãƒƒã‚°ï¼‰: ã€Œå°‘ã—å‹•ã„ãŸã‚‰ã€é–‹å§‹ï¼†ãƒªãƒ³ã‚¯ä¸Šã¯é–‹å§‹ã—ãªã„ ----
  const DRAG_THRESHOLD = 6; // pxï¼ˆã“ã®è·é›¢ã‚ˆã‚Šå‹•ã„ãŸã‚‰ãƒ‰ãƒ©ãƒƒã‚°æ‰±ã„ï¼‰
  let isDragging = false;
  let dragArmed = false;   // æŠ¼ã—ãŸç›´å¾Œï¼ˆã¾ã ãƒ‰ãƒ©ãƒƒã‚°ã˜ã‚ƒãªã„ï¼‰
  let startX = 0, startY = 0;
  let lastX = 0, lastY = 0;

  function isOnLinkTarget(e){
    // SVGå†…ã®<a>ã‚’æ¢ã™ï¼ˆg/image/circleã‚’ã‚¿ãƒƒãƒ—ã—ã¦ã‚‚<a>ã«åŒ…ã¾ã‚Œã¦ã‚‹æƒ³å®šï¼‰
    const a = e.target && e.target.closest ? e.target.closest('a') : null;
    return !!a;
  }

  map.addEventListener('pointerdown', (e) => {
    // 2æœ¬æŒ‡ãƒ”ãƒ³ãƒå‡¦ç†ãŒã‚ã‚‹ã®ã§ã€ã“ã“ã§ã¯ã€Œ1æœ¬æŒ‡ã®æ™‚ã ã‘ã€ãƒ‘ãƒ³æº–å‚™
    if (e.pointerType === 'mouse' && e.button !== 0) return;

    // âœ…ãƒªãƒ³ã‚¯ä¸Šãªã‚‰ãƒ‘ãƒ³æº–å‚™ã—ãªã„ï¼ˆã‚¯ãƒªãƒƒã‚¯ã‚’å„ªå…ˆï¼‰
    if (isOnLinkTarget(e)) {
      dragArmed = false;
      isDragging = false;
      return;
    }

    dragArmed = true;
    isDragging = false;

    startX = lastX = e.clientX;
    startY = lastY = e.clientY;
  });

  map.addEventListener('pointermove', (e) => {
    if (!dragArmed) return;

    const dx0 = e.clientX - startX;
    const dy0 = e.clientY - startY;

    // ã¾ã ãƒ‰ãƒ©ãƒƒã‚°é–‹å§‹ã—ã¦ãªã„ãªã‚‰ã€ã—ãã„å€¤è¶…ãˆãŸã‚‰é–‹å§‹
    if (!isDragging) {
      if (Math.hypot(dx0, dy0) < DRAG_THRESHOLD) return;
      isDragging = true;
      map.setPointerCapture(e.pointerId);
    }

    const dx = e.clientX - lastX;
    const dy = e.clientY - lastY;
    lastX = e.clientX;
    lastY = e.clientY;

    const rect = map.getBoundingClientRect();
    const vb = svg.viewBox.baseVal;

    tx += dx * (vb.width / rect.width);
    ty += dy * (vb.height / rect.height);
    apply();
  });

  map.addEventListener('pointerup', (e) => {
    if (isDragging) {
      try { map.releasePointerCapture(e.pointerId); } catch {}
    }
    dragArmed = false;
    isDragging = false;
  });

  map.addEventListener('pointercancel', () => {
    dragArmed = false;
    isDragging = false;
  });

  // ---- ãƒ”ãƒ³ãƒã‚ºãƒ¼ãƒ ï¼ˆ2æœ¬æŒ‡ï¼‰ ----
  const pointers = new Map();
  let pinchStartDist = null;
  let pinchStartScale = 1;
  let pinchCenter = null;

  const dist = (a,b) => Math.hypot(a.clientX - b.clientX, a.clientY - b.clientY);

  map.addEventListener('pointerdown', (e) => {
    pointers.set(e.pointerId, e);
    if (pointers.size === 2) {
      const [p1, p2] = Array.from(pointers.values());
      pinchStartDist = dist(p1, p2);
      pinchStartScale = scale;
      pinchCenter = { x:(p1.clientX+p2.clientX)/2, y:(p1.clientY+p2.clientY)/2 };
    }
  });

  map.addEventListener('pointermove', (e) => {
    if (!pointers.has(e.pointerId)) return;
    pointers.set(e.pointerId, e);

    if (pointers.size === 2 && pinchStartDist) {
      const [p1, p2] = Array.from(pointers.values());
      const d = dist(p1, p2);
      let next = pinchStartScale * (d / pinchStartDist);
      next = Math.max(MIN_SCALE, Math.min(MAX_SCALE, next));
      zoomAt(pinchCenter.x, pinchCenter.y, next);
    }
  });

  map.addEventListener('pointerup', (e) => {
    pointers.delete(e.pointerId);
    if (pointers.size < 2) {
      pinchStartDist = null;
      pinchCenter = null;
    }
  });

  // ---- ãƒ›ã‚¤ãƒ¼ãƒ«ã‚ºãƒ¼ãƒ ï¼ˆPCï¼‰ ----
  map.addEventListener('wheel', (e) => {
    e.preventDefault();
    const step = e.deltaY > 0 ? 0.9 : 1.1;
    let next = scale * step;
    next = Math.max(MIN_SCALE, Math.min(MAX_SCALE, next));
    zoomAt(e.clientX, e.clientY, next);
  }, { passive:false });

  apply();
})();
</script>

</body>
</html>
